/*!
 * A jQuery implementation of Miller columns.
 *
 * (c) Gergő Gänszler <ganszler.gergo@gmail.com>
 *
 * Released under the MIT license
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,a){return void 0===a&&(a="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(a),a}:t(jQuery)}(function(t){var e={root:1,column:"ul",option:"li",children:function(t){},optionContent:function(t){},optionAttr:function(t){return{tabindex:"1"}},columnAttr:function(t){return{}},selectCallback:function(e){0<e.length&&e.focus();var a=t("#"+this.attr("id")+" *[data-parentId]").last();t("#"+this.attr("id")).scrollLeft(this.scrollLeft()+a.position().left+a.outerWidth()-this.width())},onClick:function(e){var a=void 0!==t(e.target).closest("*[data-id]").attr("data-id")?t(e.target).closest("*[data-id]"):void 0!==t(e.target).attr("data-parentId")&&0<t(e.target).prev("*[data-parentId]").children("*[data-id]").length?t(e.target).prev("*[data-parentId]").children('*[class~="selected"]'):0<t("#"+this.attr("id")+' *[class~="selected"]').length?t("#"+this.attr("id")+' *[class~="selected"]').last():t("#"+this.attr("id")+" *[data-id]:first-child");return this.data("ggergo-mc").children.call(this,a.attr("data-id")).length>0&&e.preventDefault(),a}},a={init:function(i){void 0!==this.attr("id")&&""!==this.attr("id")||t.error("Selected element must have id attribute!");var r=this;void 0===this.data("ggergo-mc")?(this.data("ggergo-mc",t.extend({},e,i)),t(document).on("click","#"+this.attr("id"),function(e){var i=r.data("ggergo-mc").onClick.call(t(this),e);void 0!==i&&null!==i&&a.selectNode.call(r,i)})):this.data("ggergo-mc",t.extend({},this.data("ggergo-mc"),i)),this.html(""),a.selectNode.call(this,this.data("ggergo-mc").root)},selectNode:function(e){var a;if("object"==typeof e){for(;e.parent().get(0)!==t("#"+this.attr("id")+" *[data-parentId]:last").get(0);)t("#"+this.attr("id")+" *[data-parentId]:last").remove();e.parent().children("*[data-id]").removeClass("selected"),e.addClass("selected"),a=e.attr("data-id")}else a=e,e=t("#"+this.attr("id")+' *[data-id="'+a+'"]').last();(function(e,a){if(a.length>0){for(var i=t("<"+this.data("ggergo-mc").column+"/>",this.data("ggergo-mc").columnAttr.call(this,e)).attr("data-parentId",e),r=0;r<a.length;r++){var d=t("<"+this.data("ggergo-mc").option+"/>",this.data("ggergo-mc").optionAttr.call(this,a[r])).attr("data-id",a[r]).html(this.data("ggergo-mc").optionContent.call(this,a[r]));i.append(d)}this.append(i)}}).call(this,a,this.data("ggergo-mc").children.call(this,a)),this.data("ggergo-mc").selectCallback.call(this,e)}};t.fn.ggergoMillerColumns=function(e){return a[e]?a[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?t.error("Method "+e+" does not exist on jQuery.ggergoMillerColumns"):a.init.apply(this,arguments)}});